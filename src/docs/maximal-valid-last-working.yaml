#maximal-valid
codeGen:
  registryClass: "Registry"
  codePath: "C:/Temp/GeneratedCode"
  namespace: "ServiceRegistry"
  initializer: "InitializeAsync"

namespace:
  - name: "InterfaceDefinition"
    interface:
      - name: "IFileLogger"
      - name: "ISettingConfiguration"
      - name: "ISettingsRepository"
      - name: "IBackgroundService"
    class: []

  - name: "InterfaceDefinition.Settings"
    interface:
      - name: "ISettingOverridesProvider"
    class: []

  - name: "System"
    interface: []
    class:
      - name: "String"
        interface: null
        parameter: []
      - name: "Boolean"
        interface: null
        parameter: []

  - name: "System.Threading"
    interface: []
    class:
      - name: "CancellationTokenSource"
        interface: null
        parameter: []

  - name: "Logging"
    interface: []
    class:
      - name: "FileLogger"
        interface: InterfaceDefinition.IFileLogger
        parameter:
          - name: "fileSizeLimitBytes"
            class: "System.Int32"
            interface: null
          - name: "minimumLevel"
            class: "System.String"
            interface: null
          - name: "outputTemplate"
            class: "System.String"
            interface: null
          - name: "relativeLogPath"
            class: "System.String"
            interface: null
          - name: "retainedFileCountLimit"
            class: "System.Int32"
            interface: null
          - name: "rollingInterval"
            class: "System.String"
            interface: null
          - name: "rollOnFileSizeLimit"
            class: "System.Boolean"
            interface: null

  - name: "MauiSettingOverridesProviders"
    interface: []
    class:
      - name: "AppDataSettingOverridesProvider"
        interface: InterfaceDefinition.Settings.ISettingOverridesProvider
        parameter:
          - name: "filename"
            class: "System.String"

  - name: "Settings"
    interface: []
    class:
      - name: "SettingConfiguration"
        interface: InterfaceDefinition.ISettingConfiguration
        parameter:
          - name: "defaultValue"
            class: "System.String"
            interface: null
          - name: "description"
            class: "System.String"
            interface: null
          - name: "expectedValueType"
            class: "System.String"
            interface: null  
          - name: "group"
            class: "System.String"
            interface: null
          - name: "isEditable"
            class: "System.Boolean"
            interface: null
          - name: "path"
            class: "System.String"
            interface: null
          - name: "enumValues"
            class: "System.String[]"
            interface: null
          - name: "isSecret"
            class: "System.Boolean?"
            interface: null
      - name: "SettingsRepository"
        interface: InterfaceDefinition.ISettingsRepository
        parameter:
          - name: "iFileLogger"
            class: null
            interface: "InterfaceDefinition.IFileLogger"
          - name: "settingConfigurations"
            class: null
            interface: "InterfaceDefinition.ISettingConfiguration[]"
          - name: "iSettingOverridesProvider"
            class: null
            interface: "InterfaceDefinition.Settings.ISettingOverridesProvider"

  # ========================================
  # NEW: MetWorksWeather Services Namespace
  # ========================================
  - name: "MetWorksServices"
    interface: []
    class:
      - name: "ProvenanceTracker"
        interface: null
        parameter:
          - name: "iFileLogger"
            class: null
            interface: "InterfaceDefinition.IFileLogger"
      - name: "WeatherDataTransformer"
        interface: null
        parameter:
          - name: "iFileLogger"
            class: null
            interface: "InterfaceDefinition.IFileLogger"
          - name: "iSettingsRepository"
            class: null
            interface: "InterfaceDefinition.ISettingsRepository"
          - name: "provenanceTracker"
            class: "MetWorksServices.ProvenanceTracker"
            interface: null

  - name: "UdpInRawPacketRecordTypedOut"
    interface: []
    class:
      - name: "Transformer"
        interface: InterfaceDefinition.IBackgroundService
        parameter:
          - name: "iFileLogger"
            class: null
            interface: "InterfaceDefinition.IFileLogger"
          - name: "iSettingsRepository"
            class: null
            interface: "InterfaceDefinition.ISettingsRepository"
          - name: "externalCancellationTokenSource"
            class: "System.Threading.CancellationTokenSource"
            interface: null
          # NEW: Optional provenance tracker parameter
          - name: "provenanceTracker"
            class: "MetWorksServices.ProvenanceTracker"
            interface: null

  - name: "RawPacketRecordTypedInPostgresOut"
    interface: []
    class:
      - name: "ListenerSink"
        interface: InterfaceDefinition.IBackgroundService
        parameter:
          - name: "iFileLogger"
            class: null
            interface: "InterfaceDefinition.IFileLogger"
          - name: "iSettingsRepository"
            class: null
            interface: "InterfaceDefinition.ISettingsRepository"
          # NEW: Optional provenance tracker parameter
          - name: "provenanceTracker"
            class: "MetWorksServices.ProvenanceTracker"
            interface: null

instance:
  - name: "RootCancellationTokenSource"
    class: "System.Threading.CancellationTokenSource"
    assignment: []
    element: []

  - name: "TheFileLogger"
    class: "Logging.FileLogger"
    assignment:
      - name: "fileSizeLimitBytes"
        literal: "10485760"
        instance: null
      - name: "minimumLevel"
        literal: "Information"
        instance: null
      - name: "outputTemplate"
        literal: "[{Timestamp:yyyy-MM-dd HH:mm:ss} {Level:u3}] {Message:lj}{NewLine}{Exception}"
        instance: null
      - name: "relativeLogPath"
        literal: "Logs/log-.txt"
        instance: null
      - name: "retainedFileCountLimit"
        literal: "7"
        instance: null
      - name: "rollingInterval"
        literal: "Day"
        instance: null
      - name: "rollOnFileSizeLimit"
        literal: "true"
        instance: null
    element: []

  # ========================================
  # NEW: ProvenanceTracker Instance
  # ========================================
  - name: "TheProvenanceTracker"
    class: "MetWorksServices.ProvenanceTracker"
    assignment:
      - name: "iFileLogger"
        literal: null
        instance: "TheFileLogger"
    element: []

  - name: "TheUdpPortSetting"
    class: "Settings.SettingConfiguration"
    assignment:
      - name: "defaultValue"
        literal: "50222"
        instance: null
      - name: "description"
        literal: "UDP Port for listening for readings from Tempest Weather Station"
        instance: null
      - name: "expectedValueType"
        literal: "Int32"
        instance: null
      - name: "group"
        literal: "UDPSettings"
        instance: null
      - name: "isEditable"
        literal: "true"
        instance: null
      - name: "path"
        literal: "/services/UDPSettings/PreferredPort"
        instance: null
      - name: "enumValues"
        literal: "[]"
        instance: null
      - name: "isSecret"
        literal: null
        instance: null
    element: []

  - name: "TheUdpPortSettings"
    class: "Settings.SettingConfiguration[]"
    assignment: []
    element:
      - literal: null
        instance: "TheUdpPortSetting"

  - name: "TemperatureOptions"
    class: "System.String[]"
    assignment: []
    element:
      - literal: "degree celsius"
        instance: null
      - literal: "degree fahrenheit"
        instance: null

  - name: "UdpTemperatureSetting"
    class: "Settings.SettingConfiguration"
    assignment:
      - name: "defaultValue"
        literal: "degree fahrenheit"
      - name: "description"
        literal: "Override temperature unit for UDP readings"
        instance: null
      - name: "expectedValueType"
        literal: "String"
        instance: null
      - name: "group"
        literal: "units"
        instance: null
      - name: "isEditable"
        literal: "true"
        instance: null
      - name: "path"
        literal: "/services/udp/unitOverrides/temperature"
        instance: null
      - name: "enumValues"
        literal: null
        instance: "TemperatureOptions"
      - name: "isSecret"
        literal: null
        instance: null
    element: []

  - name: "WindspeedOptions"
    class: "System.String[]"
    assignment: []
    element:
      - literal: "kilometer/hour"
        instance: null
      - literal: "knot"
        instance: null
      - literal: "meter/second"
        instance: null
      - literal: "mile/hour"
        instance: null

  - name: "UdpWindspeedSetting"
    class: "Settings.SettingConfiguration"
    assignment:
      - name: "defaultValue"
        literal: "mile/hour"
        instance: null
      - name: "description"
        literal: "Override wind speed unit for UDP readings"
        instance: null
      - name: "expectedValueType"
        literal: "String"
        instance: null
      - name: "group"
        literal: "units"
        instance: null
      - name: "isEditable"
        literal: "true"
        instance: null
      - name: "path"
        literal: "/services/udp/unitOverrides/windSpeed"
        instance: null
      - name: "enumValues"
        literal: null
        instance: "WindspeedOptions"
      - name: "isSecret"
        literal: null
        instance: null
    element: []

  - name: "PressureOptions"
    class: "System.String[]"
    assignment: []
    element:
      - literal: "atmosphere"
        instance: null
      - literal: "bar"
        instance: null
      - literal: "hectopascal"
        instance: null
      - literal: "inch of mercury"
        instance: null
      - literal: "kilopascal"
        instance: null
      - literal: "millibar"
        instance: null
      - literal: "pascal"
        instance: null

  - name: "UdpPressureSetting"
    class: "Settings.SettingConfiguration"
    assignment:
      - name: "defaultValue"
        literal: "millibar"
        instance: null
      - name: "description"
        literal: "Override pressure unit for UDP readings"
        instance: null
      - name: "expectedValueType"
        literal: "String"
        instance: null
      - name: "group"
        literal: "units"
        instance: null
      - name: "isEditable"
        literal: "true"
        instance: null
      - name: "path"
        literal: "/services/udp/unitOverrides/pressure"
        instance: null
      - name: "enumValues"
        literal: null
        instance: "PressureOptions"
      - name: "isSecret"
        literal: null
        instance: null
    element: []

  - name: "PrecipitationOptions"
    class: "System.String[]"
    assignment: []
    element:
      - literal: "centimeter"
        instance: null
      - literal: "inch"
        instance: null
      - literal: "millimeter"
        instance: null

  - name: "UdpPrecipitationSetting"
    class: "Settings.SettingConfiguration"
    assignment:
      - name: "defaultValue"
        literal: "inch"
        instance: null
      - name: "description"
        literal: "Override precipitation unit for UDP readings"
        instance: null
      - name: "expectedValueType"
        literal: "String"
        instance: null
      - name: "group"
        literal: "units"
        instance: null
      - name: "isEditable"
        literal: "true"
        instance: null
      - name: "path"
        literal: "/services/udp/unitOverrides/precipitation"
        instance: null
      - name: "enumValues"
        literal: null
        instance: "PrecipitationOptions"
      - name: "isSecret"
        literal: null
        instance: null
    element: []

  - name: "DistanceOptions"
    class: "System.String[]"
    assignment: []
    element:
      - literal: "kilometer"
        instance: null
      - literal: "meter"
        instance: null
      - literal: "mile"
        instance: null
      - literal: "nautical mile"
        instance: null

  - name: "UdpDistanceSetting"
    class: "Settings.SettingConfiguration"
    assignment:
      - name: "defaultValue"
        literal: "mile"
        instance: null
      - name: "description"
        literal: "Override distance unit for UDP readings"
        instance: null
      - name: "expectedValueType"
        literal: "String"
        instance: null
      - name: "group"
        literal: "units"
        instance: null
      - name: "isEditable"
        literal: "true"
        instance: null
      - name: "path"
        literal: "/services/udp/unitOverrides/distance"
        instance: null
      - name: "enumValues"
        literal: null
        instance: "DistanceOptions"
      - name: "isSecret"
        literal: null
        instance: null
    element: []

  - name: "TheUdpListenerSettings"
    class: "Settings.SettingConfiguration[]"
    assignment: []
    element:
      - literal: null
        instance: "UdpTemperatureSetting"
      - literal: null
        instance: "UdpWindspeedSetting"
      - literal: null
        instance: "UdpPressureSetting"
      - literal: null
        instance: "UdpPrecipitationSetting"
      - literal: null
        instance: "UdpDistanceSetting"

  - name: "TheAppDataSettingOverridesProvider"
    class: "MauiSettingOverridesProviders.AppDataSettingOverridesProvider"
    assignment:
      - name: "filename"
        literal: "TheOverridesFile.ovr"
        instance: null
    element: []

  - name: "TheUDPSettingsRepository"
    class: "Settings.SettingsRepository"
    assignment:
      - name: "iFileLogger"
        literal: null
        instance: "TheFileLogger"
      - name: "settingConfigurations"
        literal: null
        instance: "TheUdpPortSettings"
      - name: "iSettingOverridesProvider"
        literal: null
        instance: "TheAppDataSettingOverridesProvider"
    element: []

  # ========================================
  # NEW: WeatherDataTransformer Instance
  # ========================================
  - name: "TheWeatherDataTransformer"
    class: "MetWorksServices.WeatherDataTransformer"
    assignment:
      - name: "iFileLogger"
        literal: null
        instance: "TheFileLogger"
      - name: "iSettingsRepository"
        literal: null
        instance: "TheUDPSettingsRepository"
      - name: "provenanceTracker"
        literal: null
        instance: "TheProvenanceTracker"
    element: []

  - name: "TheUdpListener"
    class: "UdpInRawPacketRecordTypedOut.Transformer"
    assignment:
      - name: "iFileLogger"
        literal: null
        instance: "TheFileLogger"
      - name: "iSettingsRepository"
        literal: null
        instance: "TheUDPSettingsRepository"
      - name: "externalCancellationTokenSource"
        literal: null
        instance: "RootCancellationTokenSource"
      # NEW: Wire up provenance tracker
      - name: "provenanceTracker"
        literal: null
        instance: "TheProvenanceTracker"
    element: []

  - name: "ThePostgresConnection"
    class: "Settings.SettingConfiguration"
    assignment:
      - name: "defaultValue"
        literal: "Host=sampleIP;Username=sampleUser;Password=samplePassword;Database=sampleDatabase;SslMode=Disable"
        instance: null
      - name: "description"
        literal: "Connection string for save weather data to Postgres"
        instance: null
      - name: "expectedValueType"
        literal: "String"
        instance: null
      - name: "group"
        literal: "database"
        instance: null
      - name: "isEditable"
        literal: "true"
        instance: null
      - name: "path"
        literal: "/services/RawPacketRecordTypedInPostgresOut/connectionString"
        instance: null
      - name: "enumValues"
        literal: "[]"
        instance: null
      - name: "isSecret"
        literal: "true"
        instance: null
    element: []

  - name: "ThePostgresSettings"
    class: "Settings.SettingConfiguration[]"
    assignment: []
    element:
      - literal: null
        instance: "ThePostgresConnection"

  - name: "ThePostgresSettingsRepository"
    class: "Settings.SettingsRepository"
    assignment:
      - name: "iFileLogger"
        literal: null
        instance: "TheFileLogger"
      - name: "settingConfigurations"
        literal: null
        instance: "ThePostgresSettings"
      - name: "iSettingOverridesProvider"
        literal: null
        instance: "TheAppDataSettingOverridesProvider"
    element: []

  - name: "TheRawPacketRecordTypedInPostgresOut"
    class: "RawPacketRecordTypedInPostgresOut.ListenerSink"
    assignment:
      - name: "iFileLogger"
        literal: null
        instance: "TheFileLogger"
      - name: "iSettingsRepository"
        literal: null
        instance: "ThePostgresSettingsRepository"
      # NEW: Wire up provenance tracker
      - name: "provenanceTracker"
        literal: null
        instance: "TheProvenanceTracker"
    element: []